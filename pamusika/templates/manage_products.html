<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h1 class="mb-4">Manage Products</h1>

    <!-- Flash Messages for Success/Error -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="alert alert-dismissible fade show" role="alert">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Product Form -->
    <div class="card mb-4">
        <div class="card-header">
            <h2>{{ "Edit Product" if request.form.get("product_id") else "Add Product" }}</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="/products">
                <input type="hidden" name="product_id" id="product_id" value="{{ request.form.get('product_id', '') }}">

                <div class="mb-3">
                    <label for="meta_id" class="form-label">Meta ID</label>
                    <input type="text" class="form-control" id="meta_id" name="meta_id" required value="{{ request.form.get('meta_id', '') }}">
                </div>

                <div class="mb-3">
                    <label for="name" class="form-label">Product Name</label>
                    <input type="text" class="form-control" id="name" name="name" required value="{{ request.form.get('name', '') }}">
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="cost_price" class="form-label">Cost Price</label>
                        <input type="number" step="0.01" class="form-control" id="cost_price" name="cost_price" required value="{{ request.form.get('cost_price', '') }}">
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="selling_price" class="form-label">Selling Price</label>
                        <input type="number" step="0.01" class="form-control" id="selling_price" name="selling_price" required value="{{ request.form.get('selling_price', '') }}">
                    </div>
                </div>

                <div class="mb-3">
                    <label for="currency" class="form-label">Currency</label>
                    <input type="text" class="form-control" id="currency" name="currency" required value="{{ request.form.get('currency', 'USD') }}">
                </div>

                <div class="mb-3">
                    <label for="product_category" class="form-label">Product Category</label>
                    <select class="form-control" id="product_category" name="product_category" required>
                        <option value="" disabled selected>Select a category</option>
                        <option value="Fruit" {% if request.form.get('product_category') == 'Fruit' %}selected{% endif %}>Fruits</option>
                        <option value="Vegetable" {% if request.form.get('product_category') == 'Vegetable' %}selected{% endif %}>Vegetables</option>
                        <option value="Detergent" {% if request.form.get('product_category') == 'Detergent' %}selected{% endif %}>Detergents</option>
                    </select>
                </div>
                

                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="availability" name="availability" {% if request.form.get('availability', 'true') == 'true' %} checked {% endif %}>
                    <label class="form-check-label" for="availability">Available</label>
                </div>

                <button type="submit" class="btn btn-primary">Save Product</button>
            </form>
        </div>
    </div>

    <!-- Product List -->
    <h2>Existing Products</h2>
    <table class="table table-striped">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Meta ID</th>
                <th>Name</th>
                <th>Cost Price</th>
                <th>Selling Price</th>
                <th>Reward</th>
                <th>Currency</th>
                <th>Category</th>
                <th>Available</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.meta_id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.cost_price }}</td>
                <td>{{ product.selling_price }}</td>
                <td>{{ product.reward_amount }}</td>
                <td>{{ product.currency }}</td>
                <td>{{ product.product_category }}</td>
                <td>{{ "Yes" if product.availability else "No" }}</td>
                <td>
                    <button class="btn btn-sm btn-warning" onclick="editProduct('{{ product.id }}', '{{ product.meta_id }}', '{{ product.name }}', '{{ product.cost_price }}', '{{ product.selling_price }}', '{{ product.currency }}', '{{ product.product_category }}', {{ product.availability|lower }})">Edit</button>
                    <form method="POST" action="/products/delete/{{ product.id }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function editProduct(id, meta_id, name, cost_price, selling_price, currency, category, availability) {
        document.getElementById('product_id').value = id;
        document.getElementById('meta_id').value = meta_id;
        document.getElementById('name').value = name;
        document.getElementById('cost_price').value = cost_price;
        document.getElementById('selling_price').value = selling_price;
        document.getElementById('currency').value = currency;
        document.getElementById('product_category').value = category;
        document.getElementById('availability').checked = availability;
    }
</script>

</body>
</html>
